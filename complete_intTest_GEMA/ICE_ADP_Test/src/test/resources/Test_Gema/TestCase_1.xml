<?xml version="1.0" encoding="UTF-8"?>
<spring:beans xmlns="http://www.citrusframework.org/schema/testcase"
              xmlns:jms="http://www.citrusframework.org/schema/jms/testcase"
              xmlns:ws="http://www.citrusframework.org/schema/ws/testcase"
              xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.citrusframework.org/schema/jms/testcase http://www.citrusframework.org/schema/jms/testcase/citrus-jms-testcase.xsd
                  http://www.citrusframework.org/schema/ws/testcase http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd
                  http://www.citrusframework.org/schema/testcase http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd">


    <testcase name="TestCase_1">
        <meta-info>
            <author>Catenate</author>
            <creationdate>2017-09-13</creationdate>
            <status>DRAFT</status>
            <last-updated-by>Catenate</last-updated-by>
            <last-updated-on>2017-09-13T19:24:21</last-updated-on>
        </meta-info>

        <description> Testing GEMA_ADP_ICE process : 'TestCase Description here'</description>


        <actions>

            <!-- Action_1  : send soap/JMS
            <echo>
                <message>SENDING SOAP/JMS REQUEST TO ADP(EAI)</message>
            </echo>-->
            <send endpoint="ADP_JMS_ENDPOINT" actor="max_eai" >
                <message>

                    <data>
                        <![CDATA[
                        <ns0:GetWorkDetailsRequest xmlns:ns0="http://www.gema.de/ESB/Service/ICE/Work-001">
                            <ns1:workDetails xmlns:ns1="http://www.gema.de/ESB/Schema/Mega/WorkDetails-001" xsdVersion="1">
                                <ns1:workDetail iceWorkKey="1"/>
                            </ns1:workDetails>
                        </ns0:GetWorkDetailsRequest>
                        ]]>
                    </data>
                </message>
                <header>
                    <data>
                        <![CDATA[
                                <ns:traceIdentifier xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns="http://www.gema.de/ESB/Schema/Common/BaseTypes-001" xmlns:ns0="http://schemas.xmlsoap.org/soap/envelope/">
                                    <ns:bpId>1</ns:bpId>
                                    <ns:bpName>Work1</ns:bpName>
                                    <ns:boId>
                                        <ns:name>A</ns:name>
                                        <ns:value>A</ns:value>
                                    </ns:boId>
                                    <ns:callingApp>TEST</ns:callingApp>
                                    <ns:initiator>TEST</ns:initiator>
                                </ns:traceIdentifier>
                        ]]>
                    </data>
                    <data>
                        <![CDATA[
                            <ns:controllObject xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns="http://www.gema.de/ESB/Schema/Common/BaseTypes-001" xmlns:ns0="http://schemas.xmlsoap.org/soap/envelope/">
                                <ns:timeOut_s>20</ns:timeOut_s>
                                <ns:transactionId>1505127273191</ns:transactionId>
                            </ns:controllObject>
                        ]]>
                    </data>
                    <element name="Content_Type" value='text/xml; charset="utf-8"'/>
                    <element name="Mime_Version" value="1.0"/>
                    <element name="SoapAction" value="/Work001/getWorkDetails"/>
                </header>
            </send>


            <!-- Action_2  : ICE receive SOAP/HTTP request
            <echo>
                <message>ICE RECEIVE REQUEST FROM ADP (EAI)</message>
            </echo>-->
            
            <receive endpoint="ICE_server">
                <message schema-validation="false">
                    <data>
                        <![CDATA[
							<iac:iac9361 xmlns:iac="http://iac9361.wsbeans.iseries/">
							  <!--Optional:--> 
							  <arg0>
									<_IACSESSION>
										<_USERNUMBER>0.0</_USERNUMBER>
										<_USERID>GEMA</_USERID>
										<_LANGCODE>EN</_LANGCODE>
										<_SHWNATCHAR>Y</_SHWNATCHAR>
									</_IACSESSION>
									<_IAC9361I>
										<_WORKKEY>1.0</_WORKKEY>
										<_REPLIST>Y</_REPLIST>
										<_WRKREFLIST>N</_WRKREFLIST>
										<_NOTELIST>N</_NOTELIST>
									</_IAC9361I>
								</arg0>  
							</iac:iac9361>
					    ]]>
                    </data>
                </message>
            </receive>


            <!-- Action_3  : ICE reply to ADP
            <echo>
                <message>ICE REPLY TO ADP (EAI)</message>
            </echo> -->
            <ws:send endpoint="ICE_server">
                <message>
                    <data>
                        <![CDATA[
							<ns0:iac9361Response xmlns:ns0 = "http://iac9361.wsbeans.iseries/">
								<return>
									<_IACRESLIST>
										<_RETNOOFROW>0</_RETNOOFROW>
									</_IACRESLIST>
									<_IACRETMSGS>
										<_MSGSEVER>0</_MSGSEVER>
										<_MSGTEXT>messaaggio L3</_MSGTEXT>
									</_IACRETMSGS>
									<_IAC9361D>
										<_WORKKEY>1</_WORKKEY>
										<_WORKTITLE>Mex L3 Mancante</_WORKTITLE>
										<_WORKSTATUS>1</_WORKSTATUS>
									</_IAC9361D>
									<_IAC9361L1>
										<_LOCAFFNBR>4</_LOCAFFNBR>
										<_NAME>mexL3</_NAME>
										<_FIRSTNAME>gab</_FIRSTNAME>
										<_CAECODE>PA</_CAECODE>
										<_MECEXCEPT>L3</_MECEXCEPT>
									</_IAC9361L1>
									<_IAC9361L2>
										<_REPCODE>s</_REPCODE>
										<_NAME>s</_NAME>
									</_IAC9361L2>
									<_IAC9361L4>
										<_NOTETEXT>Ciao</_NOTETEXT>
									</_IAC9361L4>
								</return>
							</ns0:iac9361Response>
					 ]]>
                    </data>
                </message>
            </ws:send>


            <!-- Action_4  : ADP reply to MAX through soap/JMS
            <echo>
                <message>ADP REPLY TO MAX </message>
            </echo>-->
            <receive endpoint="ADP_JMS_ENDPOINT" actor="max_eai" >
                <message>
                    <data>
                        <![CDATA[
							<?xml version="1.0" encoding="UTF-8"?>
			                	<ns2:workDetails xmlns:ns2 = "http://www.gema.de/ESB/Schema/Mega/WorkDetails-001" xsdVersion = "1">
									<ns2:workDetail iceWorkKey = "1">
										<ns2:status>
											<ns2:errorCode>OK</ns2:errorCode>
											<ns2:errorMessage>messaaggio L3</ns2:errorMessage>
										</ns2:status>
										<ns2:work>
											<ns2:workStatusDetails>
												<ns2:iceStatus>1</ns2:iceStatus>
												<ns2:iceStatusDesc>Work Fully Documented</ns2:iceStatusDesc>
												<ns2:comments>
													<ns2:comment>Ciao</ns2:comment>
												</ns2:comments>
											</ns2:workStatusDetails>
											<ns2:interestedParties>
												<ns2:interestedParty roleCode = "COMPOSER" source = "ICE" type = "ARTIST">
													<ns2:part type = "FIRST_NAME">gab</ns2:part>
													<ns2:part type = "LAST_NAME">mexL3</ns2:part>
													<ns2:ipBaseNumber/>
													<ns2:ipNameNumber/>
													<ns2:iceIpBaseKey/>
													<ns2:iceIpNameKey/>
													<ns2:societyIpNumbers>
														<ns2:societyIpNumber>
															<ns2:cisac/>
															<ns2:name/>
															<ns2:ipNumber>4</ns2:ipNumber>
														</ns2:societyIpNumber>
													</ns2:societyIpNumbers>
												</ns2:interestedParty>
											</ns2:interestedParties>
											<ns2:repertoires>
												<ns2:repertoire>
													<ns2:id>s</ns2:id>
													<ns2:name>s</ns2:name>
												</ns2:repertoire>
											</ns2:repertoires>
										</ns2:work>
									</ns2:workDetail>
							</ns2:workDetails>
                                                     ]]>
                    </data>
                </message>
            </receive>

        </actions>
    </testcase>
</spring:beans>
